@startuml
!include style.puml

participant ":MainApp" as MainApp MODEL_COLOR_T1

box Storage STORAGE_COLOR_T1
participant "<<class>>\n:TestStorage" as TestStorage STORAGE_COLOR
participant ":Storage" as Storage STORAGE_COLOR
end box

box UI UI_COLOR_T1
participant "<<class>>\n:DialogManager" as DialogManager UI_COLOR
participant ":Ui" as Ui UI_COLOR
end box

box Logic LOGIC_COLOR_T1
participant ":Logic" as Logic LOGIC_COLOR
end box

box Model MODEL_COLOR_T1
participant ":Model" as Model MODEL_COLOR
end box

[-> MainApp : start(primaryStage)
activate MainApp

MainApp -> TestStorage : isUserExist()
activate TestStorage

TestStorage --> MainApp : userExists
deactivate TestStorage

alt user does not exist
    MainApp -> DialogManager : showCreatePasswordDialog()
    activate DialogManager

    DialogManager --> MainApp : password
    deactivate DialogManager

    MainApp -> TestStorage : initPassword(password)
    activate TestStorage
    deactivate TestStorage

else user exists
    loop password is incorrect
        MainApp -> DialogManager : showValidatePasswordDialog()
        activate DialogManager

        DialogManager --> MainApp : password
        deactivate DialogManager

        MainApp -> TestStorage : testPassword(password)
        activate TestStorage

        TestStorage --> MainApp : isCorrect
        deactivate TestStorage
    end

end

MainApp -> MainApp : initWithPassword(password)
activate MainApp

create Storage
MainApp -> Storage

create Model
MainApp -> Model

create Logic
MainApp -> Logic

create Ui
MainApp -> Ui

deactivate MainApp

MainApp -> MainApp : startSecureIt(primaryStage)
activate MainApp

MainApp -> Ui : start(primaryStage)
activate Ui

@enduml
